// Hopefully no one will ever see this code...
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0o:ldxxddddddddoooooodoolc:;,''',:llc:,,,:ld0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNO:.'coddoooooooooooooooollcc:;;'....';;;,'',cdONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXd;.';clcc:::;;::::::::::::;;;;;;,,''......''..,:dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo'.',,'...'''''',,;;;;;,,,,''''''''',,,,'....    'lkXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNx' ......,;:ccccllllllllllllllc:;'.............   .;oxOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0:.    .',,;;:::cc::;,,'',,;:cccllc;'...    ....   .,lddx0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNx'    .''.....';::;'........',,,,;;;;,'... ... ..  .':ldod0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXl.. ..'.......':oo:'.....   .....'',;;;,.....  ..   .,:loodOXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKc....... ....':oxdc;,,,,'..........,;;;,'....  ..   ..,clllokXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0c....'''',;:cldxdolcccclc:::;;;;;;::c::,'........   ..':looooxKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMNOkO0KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0:....,:::cclldxdlcccloodolllllloooolc:;'..........   ..,clooooxKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMM0:,,,;coxOKXNWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO;...':llloolcclccccccclddddooollllcc:;'...''...'..   ...;cloolod0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMWO;''',,;:clodxkOKXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNx,...,:llolc,'....';;;;:loooollc:::;;,'....'....'.     ..':coollldkXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMWk,''',;:cclllccccldk0NWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl'...,;cccc:,.......';:cllllcc:;;;,,,'....''...''.  .. ...,:lolllloxXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMNd,.',:clloooll:;,,,,:cd0NMMMMMMMMMMMMMMMMMMMMMMMMMMWO:'...';:::ccc:;;;:::coooolcc:::;;,,,.....''....'.   ..   .';clllccclxXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMXo'',:clodxxxdoc;,'.....,l0WMMMMMMMMMMMMMMMMMMMMMMMMNk;''..',;:cllc:::::cloooooolcc:::;;,'....''....''.  .'..   .';colc::clkNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMM0:';:loddxxxxdoc:,'.......'dXMMMMMMMMMMMMMMMMMMMMMMMXd;''..',;::;,''''..'',;;:cccc::::;,'...''''.. .,'.  .,'.    .,:lllc::coONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMWx;,:ldxkkkkxxdoc;,.......  .lKMMMMMMMMMMMMMMMMMMMMMMKl,'''',,;;,'',;;;;,,''''',;;:::;;,....''''.. .',.   ';'.    ..,clllc::cokNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMXl';coxkkOOkxdol:,'.....     .lKMMMMMMMMMMMMMMMMMMMMWO:''''',,,,,'''''''''',,,,,,,;,,,'.....''...  .,'.  .,;'      .';cllcc::clxXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMM0:.';ldxkkkkxoc:,'...      .':xXWMMMMMMMMMMMMMMMMMMMXd,''''.',,,,,'',,;;;,,,,,,,,,,''...........  .,,.   .,;.       .,;cllc::::lkNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMNx'...,:looddol:,...     .,oOXWMMMMMMMMMMMMMMMMMMMMMW0c'...'..'',,;;:cllllc:::;;;,,'...........    .,,.   .;;.       ..,:cccc::::lOWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMM0;. .....',;;;;'...   .'ckXWMMMMMMMMMMMMMMMMMMMMMMMMXd;'...'...'',;::ccccc:::;;;;,'...........    .',.   .':;..       .';:cccc::::o0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMWNd. .....   ........':oOXWMMMMMMMMMMMMMMMMMMMMMMMMMMWOc,...','....'',,'''''''''''...   ......      .,'.   .;:;..        .';:cccc::::oKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMWNK000kc'..';:;.     ..,okKNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWOl;,..'','. ................       .....      .,,.    .:c,..        ..';:cccc::::dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMNK0Okkkxdo:,;coo:.   .,lOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKo:;'.''..'. ....                   ...       .,,..   .':c,..         ..,;:clcc::::dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMWX0kxxkkkkxollccool,. .:kNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKdc;,,,,'..'.. .....                ..         .;'.    .,cc,..         ...,;cllcc::::oKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMWXOoodxkkkkkxdlllcllccldONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dlc:;;,'...'.....                            ..'..    ..;c:'..          ..',:cllcc::::lONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMN0xddddxkkkxdooc::cccckNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0oclc::;'....''.....                         ..,'.     ..';c:'.            ..',:cllccc:::ckNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMWX0xolodxxxddxdl;,,,;cl:cOWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXdcccc::,'....,,'......                     ..,,'.     ...':c:'.            ...';:llllcc:::lkNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMNOoc;,',:odolcc:;'.',coocl0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNkc:;:::;,,'',,,;,....''..                ..';;'.      ..'',:c;.              ...';:clllcc:::lkXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMNOdl:,.. .,;;'''''..';ldolxNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKl,'';c:;;;;;::;;;,,''.''''....         ..,;;'..      ..',;:c:,.....           ...',:clllcc::clxKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMKdooc;.. .''.....',,;col::kWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWk;..':c::::cccc:;;;;,,,...',,,,,,,,''..'','...       ..';:clc;'.......          ...',;cllcccc::ldKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MW0ooool:,;;'...  ..,clll:,c0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNd'..;cccclllllcc:;;;;;;,'...',,;:::::;,'....        ..';cllc:,''',,,,'..          ..',;:lllllcccco0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWOlloolc;:,.    ..';clc;,,xNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0:..,cooooooooolc:;,;;:::;,'.....'',,,''...         ..,;cllc;,'..,;:::::,'.         ...',:clollccccoONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWOlclol:'.......';:cc:;''lXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNOl,'';looooooooolccc:;:ccc::;,'.....''''...        ...,:cc:,.....',;::cccc:'.          ...';:llolcccloONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MNx::cclc:;;;;;::::::;,''oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWX0Oxl:;;;;:coooooooolc::lc;;ccccc::;,,,,,,'....       ...,;cc:,.......,;;::ccc:,...          ....,;cllllcccoONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MXl.''',,,,;;::::;;,,'.,dXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWX0xoc;;,;,,,,,:looooooool:;;cl:;:cllllccc::;;,....      ...';cc:,.....'...,:ccccc;...''''....     ....',;ccllccclxXMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MK:....................dNMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dc;,'''',,,,'',:loodddoool:,.,cl:;;::;;;;;;;,,..     ....'';clc;.....,;,...,:cllc,...',,,,,,,,''...  ....';:cccc::cdKWMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MXc.                  .xWMMMMMMMMMMMMMMMMMMMMMMMMMMWKd;'''''''''''''',:loodddddol;. .;llc:;;'........   .....',;;:cc;'....';;,''',;:cc:'...'',,,,,,,;;;;;;,'......';::cccccd0WMMMMMMMMMMMMMMMMMMMMMMMMMM
// MNd.                  .lXMMMMMMMMMMMMMMMMMMMMMMMMWXx;....'....''''''',:ooddddddoc,. .':loolcc:;,'''..''',,,;;:cclc;.. ..';;,'',:clllc;.....'',,,,,,,;;;;;::::;'.....,;:::cclOWMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWk'                   cXMMMMMMMMMMMMMMMMMMMMMMMNk:...........''''''',:odddddddoc,. ..;clooooollcc::::::::cclll:,..  ..;::,..;coool:'. ...'',,,'''',,,,,,;;;;;,'......';;:cdKMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWk'.                  :XMMMMMMMMMMMMMMMMMMMMMW0l'............''''',,,;loddddddoc,....,:cllcllllcccccccccclc:,...  ..;::;...;clolc;.. ...''''''''''',,,,,,,,,,,,'.......';l0WMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWx.                   :XMMMMMMMMMMMMMMMMMMMWXo,.............''''',,'',:lddddddoc,....,::;,,,'''',,,;;;,,,'...   ..,::;'...;clll:'.  ....'''''..'''','''''...'''''.......l0WMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MXl.                   lNMMMMMMMMMMMMMMMMMMW0c...............''',,,,''',:oddddooc,...',,'.................    ..';::;'...,:lll:,.......'''''....''''''.................,dXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// WO,                   .xWMMMMMMMMMMMMMMMMMNk:................''',,,,,''',coddddoc,..',,,'....................';:cc;'....:clc;,.''.....'''''....'''''................ .,kNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// No.                   :KMMMMMMMMMMMMMMMMMXd,.................'',,,,,,',,,;looddoc'.',,,'..................',:clc:,.. .,cc:;'..,;,....''''.....''''...................,OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// O;.....              .dWMMMMMMMMMMMMMMMMXo'.................'',,,,,,,,,:;,:loooo:'.',,'.''',,,''''''''';:ccccc:;'...,:c:,..',:c:,...................................'oNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// d......              ,OWMMMMMMMMMMMMMMMXo..........  .......'',,,,,,,,,cc:;cllllc,'''....',,;;;;;;;:::ccc:;,'''...,::;'..';cccc;...''''............  ...............'oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// o......              ,OWMMMMMMMMMMMMMMXo...........  .......',,,,,,,,,,;;;,,;:cllc;,.....'',,;;::ccc::;,,'.....',::;...':clllc:,''',,''...........  .................:0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// :.....               .dNMMMMMMMMMMMMMXl............  .......'',,,,,,,,'....'',;:cllc:::::::ccccclllc:::;;;;,,;:c:,...,:cllllcc;'.''''''..........   .................,xNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// ,....                .cXMMMMMMMMMMMMXl............    .......'',,,,,,,'.......',;:llllllllllllloollllllllllllc:,....';:cccc::;..................   ...................cKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// '...         .        ,OMMMMMMMMMMMXo'............   .......''',,,,,,,''...'.....,;clllooooollloollooooollcc;'.  ...',:cc:;;,..  ...............   ...................;kWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// c.    ..              .dWMNXXXXXWW0l,............     .........'''''''''...........';:cclllc::cccccc::;;,''........',;:;,,'.........     ....       .....  ...........'xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// k'     ....            ;xo;,:lxOXNKOOOkxdl:,.        ';;;;:::::,. .,:cc::::;;.      .,clllllccccccc::'.      .,;::cclllc:;;.    .,:;;;;;;;;;;,.    .,;;;;;;;;::;;;;;;..lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// k'      ....           .. .l0NWMMMMMMMMMMWWXOo,     .kWWWWWWWWNx. .xNWWWWWWWNo      .kNWWWWWWWWWWWWWWk.      'OWWWWWWWWWWWNx.   ,0WWWWWWWWWWWWx.   lNWWWWWWWWWWWWWWWK: ,0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// d.           ..          .xNMMMMMMMWWMMMMMMMWW0c.   .kMMMMMMMMWx. .xWMMMMMMMWd.     ,KMMMMMMMMMMMMMMMK;      ,0MMMMMMMMMMMMK;   :XMMMMMMMMMMMMk.   oWMMMMMMMMMMMMMMMX: .dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// x.             .         lNMMMMMMMW0dx0WMMMMMMM0,   .OMMMMMMMMWx. .xWMMMMMMMWd.     cNMMMMMMMMMMMMMMMNl      '0MMMMMMMMMMMMNl   lNMMMMMMMMMMMMk.   oWMMMMMMMMMMMMMMMX:  lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// O,                      .oNMMMMMMMK:  ;KMMMMMMMNc   '0MMMMMMMMWx. .xWMMMMMMMWd.    .dWMMMMMMMMMMMMMMMWd.     '0MMMMMMMMMMMMWx. .kMMMMMMMMMMMMMk.   oWMMMMMMMMXkxxxxxo'  cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// Xc.                 ... .oNMMMMMMM0'  ,0MMMMMMMNo.  ,0MMMMMMMMWx. .xWMMMMMMMWd.    .OMMMMMMMXOXMMMMMMMO'     '0MMMMMMMMMMMMM0' ,0MMMMMMMMMMMMWk.   oWMMMMMMMMO'         :XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// Wx'                  .. .oNMMMMMMMK:  .okxxxxxxxl.  ,0MMMMMMMMWx. .xWMMMMMMMWd.    ,0MMMMMMMOoKMMMMMMMX:     ,0MMMMMMMMMMMMMX: :XMMMMMMMMMMMMWk.   oWMMMMMMMMO'         ,KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MK:.                     lXMMMMMMMMKl'.         .   ,0MMMMMMMMWx. 'xWMMMMMMMWd.    lNMMMMMMWd:OMMMMMMMWo.    ,0MMMMMMMNXWMMMWo.oNMMMNKXMMMMMMWk.   oWMMMMMMMMO'         .OMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MWx'                     'OWMMMMMMMMWXOl'.          ,0MMMMMMMMMN00KNMMMMMMMMWd.   .xMMMMMMMXc'kMMMMMMMWk.    ,0MMMMMMM0xXMMMWk:kWMMMKxKMMMMMMWk.   oWMMMMMMMM0c,,,,'.   .dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMKc.                     ,kXWMMMMMMMMMWXOl'.       ,0MMMMMMMMMMMMMMMMMMMMMMWd.   .OMMMMMMMK:.xMMMMMMMMK;    ,0MMMMMMM0o0MMMMKd0MMMWkdXMMMMMMWk.   oWMMMMMMMMWWNNNNXl    lWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMWx.                      .;kNMMMMMMMMMMMWX0d,.    ,0MMMMMMMMMMMMMMMMMMMMMMWd.   ;KMMMMMMWk'.dWMMMMMMMNl    '0MMMMMMM0lkWMMMWXNMMMNocKMMMMMMWk.   oWMMMMMMMMMMMMMMWd.   cNMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMM0,                        .;o0WMMMMMMMMMMMMNx'   ,0MMMMMMMMMMMMMMMMMMMMMMWd.   oWMMMMMMWd..cKMMMMMMMWk.   '0MMMMMMM0;lXMMMMMMMMMXc:KMMMMMMWk.   oWMMMMMMMMMMMMMMWd.   cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMNl.                          .:d0XWMMMMMMMMMWk'  ,0MMMMMMMMWKdodKWMMMMMMMWd.  .dWMMMMMMWo..;0MMMMMMMM0'   '0MMMMMMM0,;KMMMMMMMMMK;;KMMMMMMWk.   oWMMMMMMMMNkddddd;    lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMWO,                    ..........;kNMMMMMMMMMNc  ,0MMMMMMMMWd. .dWMMMMMMMWd.  ,0MMMMMMMNo'':0MMMMMMMMX:   '0MMMMMMM0,'OMMMMMMMMWk.cNMMMMMMWk.   oWMMMMMMMWO'         .oWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMNx.                  :OKKKKKKKk, .lXMMMMMMMMWd. ,0MMMMMMMMWx. .dWMMMMMMMWd.  cXMMMMMMMWXKKXWMMMMMMMMWd.  '0MMMMMMM0,.oNMMMMMMMNl :XMMMMMMWk.   oWMMMMMMMMO'         .dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMXl.                 cXMMMMMMMX:  .OMMMMMMMMWk. ,0MMMMMMMMWx. .dWMMMMMMMWd. .oNMMMMMMMMMMMMMMMMMMMMMMk.  '0MMMMMMM0, :XMMMMMMMK; ;KMMMMMMWk.   oWMMMMMMMMO'         .xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMKc.                ;XMMMMMMMNl  .xMMMMMMMMWk. ,0MMMMMMMMWx. .dWMMMMMMMWd. .xWMMMMMMMMMMMMMMMMMMMMMMK;  '0MMMMMMM0, ,0MMMMMMMk. cNMMMMMMWk.   oWMMMMMMMMO.         .kWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMKo.               ,0MMMMMMMWx..,0MMMMMMMMWx. ,0MMMMMMMMWx. .dWMMMMMMMWd. ,KMMMMMMMMW0kxk0WMMMMMMMMWo  '0MMMMMMM0, .xWMMMMMWx. cNMMMMMMWk.   oWMMMMMMMMXxooooodc. .xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMNOc.             .xWMMMMMMMWKOKWMMMMMMMMNc  ,0MMMMMMMMWx. .dWMMMMMMMWd. cXMMMMMMMMK;   :KMMMMMMMMWk. '0MMMMMMM0,  lNMMMMMNl  cNMMMMMMWk.   oWMMMMMMMMMMMMMMMMO. .xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMNOoc:::::::co;  cKWMMMMMMMMMMMMMMMMMMNx.  ,0MMMMMMMMWx. .dWMMMMMMMWd..dWMMMMMMMMO'   :XMMMMMMMMM0, '0MMMMMMM0'  ,KMMMMMK,  cNMMMMMMWk.   oWMMMMMMMMMMMMMMMMO. .dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMWWWWWWWWWM0'  ,dKNMMMMMMMMMMMMMWXO:.   ,0MMMMMMMMWd. .dNMMMMMMMWo..OMMMMMMMMWx.   ,KMMMMMMMMMNl '0MMMMMMM0'  .kMMMMMk.  :XMMMMMMWk.   oWMMMMMMMMMMMMMMMMO.  oWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMWx.  .,lONWMMMMMMMWW0d:.     'ONNNNNNNXO:   :xkOOOOOOk: .oOOkOOOOOkc.   .oOOOOkkOkkk: .okkkkkkko.  .ckkkkkc.  'dkkkkkkkc.   ;xkkkkkOOOOOOkkkkkl.  lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMM


package kubernetes

import (
    "dagger.io/dagger"
	"universe.dagger.io/docker"
    )

#Kubectl: {
	version: string | *"3.15.0@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300"
    kubeconfig: dagger.#FS
    manifest: dagger.#FS
    customimage: string
    ip: string
    namespace: string

	docker.#Build & {
		steps: [
			docker.#Pull & {
				source: "index.docker.io/alpine:\(version)"
			},
            docker.#Run & {
                //Wait for the build before deploying
                env: DEP: "\(customimage)"
                command: {
                    name: "apk"
                    args: [
                        "add",
                        "--no-cache",
                        "bash",
                        "curl",
                    ]
                }
            },
			docker.#Run & {
                command: {
                    name: "/bin/bash"
                    args: ["-c", "curl -sfL https://dl.k8s.io/v1.19.9/bin/linux/amd64/kubectl -o /usr/local/bin/kubectl && chmod +x /usr/local/bin/kubectl && chmod +x /usr/local/bin/kubectl"]
                }
			},
            docker.#Copy & {
			    contents: kubeconfig
                source:   "*"
	            dest:     "/root/"
		    },
            docker.#Copy & {
			    contents: manifest
                source:   "*"
	            dest:     "/root/manifest/"
		    },
            docker.#Run & {
                always: true
                command: {
                    name: "/bin/bash"
                    args: ["-c", "sed -i 's/minikubeiptosed/\(ip)/g' /root/config && sed -i 's$myimagetosed$\(customimage)$g' /root/manifest/pacman-deployment.yaml"]
                }
			},
            docker.#Run & {
                always: true
                command: {
                    name: "/bin/bash"
                    args: ["-c", "KUBECONFIG=\"/root/config\" kubectl create namespace \"\(namespace)\"  > /dev/null 2>&1 || true"]
                }
			},
            docker.#Run & {
                always: true
                command: {
                    name: "/bin/bash"
                    args: ["-c", "KUBECONFIG=\"/root/config\" kubectl --namespace \"\(namespace)\" apply -R -f /root/manifest/"]
                }
			},
            // Seriously...
            docker.#Run & {
                always: true
                command: {
                    name: "/bin/bash"
                    args: ["-c", "KUBECONFIG=\"/root/config\" kubectl wait --for=condition=ready pod -l name=mongo -n daggerdemo"]
                }
			},
            docker.#Run & {
                always: true
                command: {
                    name: "/bin/bash"
                    args: ["-c", "KUBECONFIG=\"/root/config\" kubectl delete po -l name=pacman -n daggerdemo"]
                }
			},
		]
	}
}
